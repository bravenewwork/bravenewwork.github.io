/**
 * audiowalk
 * @version v0.1.0 - 2014-06-22
 * @link https://github.com/lennart/audiowalk
 * @author Lennart Melzer ()
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";var app=angular.module("lennart.Audiowalk",["ngAnimate","ngRoute","mediaPlayer","ngTouch","ngSanitize","angularSpinner","FBAngular","google-maps","fitVids","angular-loading-bar"]);app.constant("version","v0.1.0").config(["$locationProvider","$routeProvider",function(e,o){o.when("/kaffee-kochen",{templateUrl:"views/kaffee-kochen.html"}).when("/:slide?",{templateUrl:"views/home.html"}).when("/contact",{templateUrl:"views/contact.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$log",function(){}]),app.controller("MainCtrl",["$scope","$location","version","$log","VideoPlayer","$window","Fullscreen","Places","$routeParams","$rootScope",function(e,o,i,n,a,t,r,d,l,s){function u(e){return p[e]}function c(o,i){p[i]=m.length,e.audioPlaylist.push({src:o})}e.$path=o.path.bind(o),e.version=i,a.get().then(function(e){n.info("got player",e)}).catch(function(e){n.error("error in video player",e)}),r.all(),n.info("Standalone",t.navigator.standalone);var p={},m=e.audioPlaylist=[];e.resolvePlaylistIndex=u,angular.forEach(d.slides,function(e,o){e.audio&&c(e.audio,o)}),e.updateCurrentSlide=function(o){e.currentSlide=d.idToSlideIndex(o),e.slide=d.slides[e.currentSlide],e.$index=e.currentSlide},s.$on("$routeChangeSuccess",function(o,i,a){a&&(n.info("Stopping Audio",e.$index),s.$emit("audio:stop:"+e.$index)),e.updateCurrentSlide(i.params.slide)})}]),app.controller("PlacesCtrl",["$rootScope","$scope","$sce","$routeParams","Places","$log","$window","$element","$location","$timeout","Geolocation","$document",function(e,o,i,n,a){o.nextSlideId=a.indexToSlideId(o.currentSlide+1),o.prevSlideId=a.indexToSlideId(o.currentSlide-1)}]),app.controller("AudioCtrl",["$rootScope","$log","$scope","$element","usSpinnerService",function(e,o,i,n,a){var t=this;i.playing=!1,i.mode="paused";var r=n.find("button"),d=i.audioPlayer;i.audioCanplay=!1,e.$on("audio:play:"+i.$index,function(){t.play()}),e.$on("audio:stop:"+i.$index,function(){t.pause()}),n.find("button").click(function(){i.toggle()}),i.toggle=function(){switch(i.mode){case"paused":t.play();case"loading":case"playing":t.pause()}},this.play=function(){switch(i.mode){case"paused":if(r.addClass("playing"),o.info("network",d.network),void 0===d.network)i.mode="loading",a.spin("audio-spinner"),d.one("suspend",function(){t.play()});else{var e=i.resolvePlaylistIndex(i.$index);o.info("playing",e),d.playPause(e,!0),a.stop("audio-spinner"),i.mode="playing"}break;case"loading":case"playing":}},this.pause=function(){switch(r.removeClass("playing"),i.mode){case"paused":break;case"loading":a.stop("audio-spinner");case"playing":d.playPause(i.resolvePlaylistIndex(i.$index),!0),i.mode="paused"}},i.slide.autoplay&&t.play()}]),app.controller("VideoCtrl",["$element","$log","$document",function(){}]),app.controller("MapCtrl",["$log","$element","$scope","$location","Geolocation",function(e,o,i,n,a){i.map={options:{fit:!0,streetViewControl:!1,maxZoom:40,minZoom:12},currentPosition:{},showKml:!0,currentMarkerOptions:{animation:google.maps.Animation.BOUNCE}},a.current().then(function(o){e.info("current position",o),i.map.currentPosition={longitude:o.coords.longitude,latitude:o.coords.latitude}}).catch(function(o){e.error("Failed to read current Position",o)}),i.kmlUrl=n.protocol()+"://"+n.host()+i.slide.maps.kml,e.info("kmlUrl",i.kmlUrl),i.kmlLayerOptions={url:i.kmlUrl}}]),app.service("Geolocation",["$rootScope","$window","$q",function(e,o,i){var n=this;this.supportGeolocation=!!o.navigator,this.current=function(){var a=i.defer();return n.supportGeolocation?o.navigator.geolocation.getCurrentPosition(function(o){e.$apply(function(){a.resolve(o)},function(e){a.reject(e)})}):a.reject({message:"Device does not support Geolocation"}),a.promise}}]),app.service("VideoPlayer",["$window","$log","$q",function(e,o,i){this.get=function(){var n=i.defer();return e.YT?n.resolve(YT.Player):e.onYouTubeIframeAPIReady=function(){o.info("YouTube Player API Ready",YT.Player),n.resolve(YT.Player)},n.promise}}]),app.value("StoryBoard",function(){return[{id:"start",title:"BRAVE<br>NEW<br>WORK"},{id:"kaffee-kochen-quote",caption:"Kaffee kochen",scrollDown:!0,video:"PFVcfyqm9_Y",videoStill:"kaffee-kochen.jpg",theme:{},effects:{out:"slideInRight","in":""}},{id:"st-oberholz",caption:"St. Oberholz",audio:"/audio/01-stoberholz.mp3"},{id:"ausland",caption:"Weg zum Haus aus einem anderen Land",maps:{center:{latitude:52.529781,longitude:13.401393},kml:"/data/01-ausland.kml",zoom:17},audio:"/audio/02-jura.mp3",autoplay:!0},{id:"brunnenstrasse",caption:"Brunnenstrasse 10",audio:"/audio/haus_aus_einem_anderen_Land.mp3"},{id:"weg-zum-leihamt",caption:"Weg zum Königlichen Leihamt",maps:{center:{latitude:52.5299474,longitude:13.3995975},kml:"/data/02-leihamt.kml",zoom:16},audio:"/audio/3 BNW unterwegs sounds 1 120614.mp3",autoplay:!0},{id:"leihamt",caption:"Königliches Leihamt",audio:"/audio/leihamt.mp3"},{id:"leerstehendes-haus",caption:"Leerstehendes Haus",audio:"/audio/leerstehendes_haus.mp3"},{id:"linienstrasse-206",caption:"Linienstrasse 206",instructions:"Content missing!"},{id:"garnisonsfriedhof",caption:"Garnisonsfriedhof",audio:"/audio/garnisonsfriedhof.mp3"},{id:"centraler-arbeitsnachweis",caption:"Centraler Arbeitsnachweis",audio:"/audio/arbeitsnachweis.mp3"},{id:"wunschgarten",caption:"Wunschgarten",audio:"/audio/wunschgarten_flitterzaun.mp3"},{id:"flitterzaun",caption:"Flitterzaun",audio:"/audio/wunschgarten_flitterzaun.mp3"},{id:"volksbuehne",caption:"Volksbühne AM Rosa-Luxemburg-Platz",audio:"/audio/wunschgarten_flitterzaun.mp3"},{id:"arbeiterdenkmal",caption:"Arbeiterdenkmal",audio:"/audio/Arbeiterdenkmal.mp3"},{id:"karl-liebknecht-haus",caption:"Karl-Liebknecht-Haus",audio:"/audio/karl-liebknecht-haus.mp3"},{id:"soho-House",caption:"Soho-House",audio:"/audio/soho-house.mp3"},{id:"tips-please",caption:"Spenden",image:"/images/tip-jar.jpg"}]}),app.factory("Places",["StoryBoard","$log",function(e){var o=e();return{idToSlideIndex:function(e){var i=o.filter(function(o){return o.id==e});return i[0]?o.indexOf(i[0]):0},indexToSlideId:function(e){var i;return(i=o[e])?i.id:null},slides:o}}]),app.directive("bnwVideoPlayer",["$log","VideoPlayer","$timeout",function(e,o,i){return{restrict:"E",link:function(n,a){var t="video-player-"+n.index;a.find(".video-player").attr("id",t);var r=a.find(".btn-video-play"),d=a.find(".spinner"),l=a.find(".glyphicon-facetime-video");n.videoLoaded=!1,n.playing=!1;var s=a.find(".video-wrapper"),u=a.find("video")[0];r.click(function(){n.loading=!0,n.playing=!0,d.removeClass("hide"),l.addClass("hide"),i(function(){o.get().then(n.loadVideo).catch(function(o){e.error("error on player get",o)})},3e3)}),n.loadVideo=function(o){e.info("player on click",o,t),n.videoLoaded,n.onVideoReady()},u.addEventListener("playing",function(){s.removeClass("hide"),r.addClass("hide")}),u.addEventListener("pause",function(){r.removeClass("hide"),s.addClass("hide"),l.removeClass("hide")}),n.onVideoReady=function(){n.videoLoaded=!0,u.play(),n.playing=!0,n.loading=!1,d.addClass("hide")},n.onStateChange=function(o){switch(e.info("state change",o),o.data){case YT.PlayerState.PLAYING:case YT.PlayerState.BUFFERING:s.removeClass("hide"),r.addClass("hide");break;case YT.PlayerState.ENDED:case YT.PlayerState.PAUSED:r.removeClass("hide"),s.addClass("hide")}},n.stopVideo=function(){player.pause(),n.playing=!1}}}}]);