/**
 * audiowalk
 * @version v0.1.0 - 2014-06-23
 * @link https://github.com/lennart/audiowalk
 * @author Lennart Melzer ()
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";var app=angular.module("lennart.Audiowalk",["ngAnimate","ngRoute","mediaPlayer","ngTouch","ngSanitize","angularSpinner","FBAngular","google-maps","fitVids","angular-loading-bar"]);app.constant("version","v0.1.0").config(["$locationProvider","$routeProvider",function(e,a){a.when("/",{templateUrl:"views/start.html"}).when("/credits",{templateUrl:"views/credits.html"}).when("/:slide?",{templateUrl:"views/slide.html"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$log",function(){}]),app.controller("MainCtrl",["$scope","$location","version","$log","$window","Fullscreen","Places","$routeParams","$rootScope",function(e,a,o,i,n,t,r,s,d){e.$path=a.path.bind(a),e.version=o,e.loadProgress={loaded:0,total:0,ready:!1,percentage:0};var l=function(a){console.log("appcacheevent: ",a,e.loadProgress),"checking"==a.type?e.loadProgress.ready=!1:"downloading"==a.type?e.loadProgress.ready=!1:"error"==a.type?(e.loadProgress.ready=!0,e.$apply()):"noupdate"==a.type?(e.loadProgress.ready=!0,e.$apply()):"progress"==a.type?(e.loadProgress.percentage=a.loaded/a.total*100+"%",e.loadProgress.total=a.total,e.loadProgress.loaded=a.loaded,e.$apply()):"cached"==a.type?(e.loadProgress.ready=!0,e.$apply()):"updateready"==a.type&&(e.loadProgress.ready=!0,e.$apply())};if(n.applicationCache){var p=n.applicationCache;p.addEventListener("error",l,!1),p.addEventListener("checking",l,!1),p.addEventListener("noupdate",l,!1),p.addEventListener("downloading",l,!1),p.addEventListener("progress",l,!1),p.addEventListener("updateready",l,!1),p.addEventListener("cached",l,!1)}t.all(),i.info("Standalone",n.navigator.standalone),e.updateCurrentSlide=function(a){i.info("updating current slide",a),e.currentSlide=r.idToSlideIndex(a),i.info("currentSlide:",e.currentSlide),e.slide=r.slides[e.currentSlide],e.$index=e.currentSlide},d.$on("$routeChangeSuccess",function(a,o,n){n&&(i.info("Stopping Audio",e.$index),d.$emit("audio:stop:"+e.$index)),e.updateCurrentSlide(o.params.slide)})}]),app.controller("PlacesCtrl",["$rootScope","$scope","$sce","$routeParams","Places","$log","$window","$element","$location","$timeout","Geolocation","$document",function(e,a,o,i,n){a.nextSlideId=n.indexToSlideId(a.currentSlide+1),a.prevSlideId=n.indexToSlideId(a.currentSlide-1)}]),app.controller("MapCtrl",["$log","$element","$scope","$location","Geolocation",function(e,a,o,i,n){o.map={center:{latitude:52.5075419,longitude:13.4261419},control:{},options:{fit:!0,streetViewControl:!1,maxZoom:40,minZoom:12,mapTypeId:"roadmap"},currentPosition:{},markers:[],showKml:!0,currentMarkerOptions:{animation:google.maps.Animation.BOUNCE}},n.current().then(function(a){e.info("current position",a),o.map.currentPosition={longitude:a.coords.longitude,latitude:a.coords.latitude},o.map.origin=""+a.coords.latitude+","+a.coords.longitude,o.getDirections()}).catch(function(a){e.error("Failed to read current Position",a)}),o.kmlUrl=o.slide.maps.kml.match(/^http/)?o.slide.maps.kml:i.protocol()+"://"+i.host()+o.slide.maps.kml,e.info("kmlUrl",o.kmlUrl),o.kmlLayerOptions={url:o.kmlUrl};var t=new google.maps.DirectionsRenderer,r=new google.maps.DirectionsService,s=new google.maps.Geocoder;o.init=function(){o.endPoint=void 0!==o.slide.maps.destination?o.slide.maps.destination:"Linienstraße 206, Berlin, Germany",s.geocode({address:o.endPoint},function(e,a){var i=e[0].geometry.location;a===google.maps.GeocoderStatus.OK?(o.map.control.getGMap().setCenter(i),o.map.markers.push({id:1,latitude:i.d,longitude:i.e,showWindow:!1,title:"Marker 2",animation:google.maps.Animation.DROP})):alert("Cannot Geocode")})},o.init(),o.getDirections=function(){var e={origin:o.map.origin,destination:o.slide.maps.destination,waypoints:o.slide.maps.waypoints,travelMode:google.maps.DirectionsTravelMode.WALKING};r.route(e,function(e,a){a===google.maps.DirectionsStatus.OK&&t.setDirections(e)}),t.setMap(o.map.control.getGMap())}}]),app.service("Geolocation",["$rootScope","$window","$q",function(e,a,o){var i=this;this.supportGeolocation=!!a.navigator,this.current=function(){var n=o.defer();return i.supportGeolocation?a.navigator.geolocation.getCurrentPosition(function(a){e.$apply(function(){n.resolve(a)},function(e){n.reject(e)})}):n.reject({message:"Device does not support Geolocation"}),n.promise}}]),app.value("StoryBoard",function(){return[{id:"kaffee-kochen-quote",caption:"Kaffee kochen",scrollDown:!0,video:"PFVcfyqm9_Y",videoStill:"kaffee-kochen.jpg",theme:{},effects:{out:"slideInRight","in":""}},{id:"st-oberholz",caption:"St. Oberholz",audio:"/audio/st.oberholz.mp3",image:"/images/st.oberholz.jpg"},{id:"ausland",caption:"Weg zum Haus aus einem anderen Land",maps:{destination:"52.529781,13.401393",waypoints:[{location:"Gaststätte St. Oberholz, Rosenthaler Straße, Berlin, Germany"}],kml:"/data/ausland.kml",zoom:17},audio:"/audio/02-jura.mp3",autoplay:!0},{id:"brunnenstrasse",caption:"Brunnenstrasse 10",audio:"/audio/haus_aus_einem_anderen_land.mp3",image:"/images/anderes_land.jpg"},{id:"weg-zum-leihamt",caption:"Weg zum Königlichen Leihamt",maps:{destination:"52.5299474,13.3995975",waypoints:[],kml:"/data/leihamt.kml",zoom:16},audio:"/audio/3_bnw_unterwegs_sounds_1_120614.mp3",autoplay:!0},{id:"leihamt",caption:"Königliches Leihamt",audio:"/audio/leihamt.mp3",image:"/images/leihamt.jpg"},{id:"weg-zum-leerstehenden-haus",caption:"Weg zum Leerstehenden Haus",maps:{destination:"52.5288755,13.4008681",waypoints:[],kml:"/data/leerstehendes-haus.kml",zoom:16},audio:"/audio/5_bnw_zwischen_ort_4_u_5_fuge_klavier_130614.mp3",autoplay:!0},{id:"leerstehendes-haus",caption:"Leerstehendes Haus",audio:"/audio/leerstehendes_haus.mp3",image:"/images/leer_haus.jpg"},{id:"weg-zum-besetzten-haus",caption:"Weg zum besetzten Haus",maps:{destination:"Linienstraße 206, Berlin, Germany",waypoints:[{location:"Linienstraße 86, Berlin, Germany"}],kml:"http://mapsengine.google.com/map/kml?mid=z-ZPPZQ1d-n8.kq9qUvV2hUhc&amp;lid=z-ZPPZQ1d-n8.kRhKazIqJh90",zoom:16}},{id:"linienstrasse-206",caption:"Linienstrasse 206",audio:"audio/besetztes_haus.mp3",image:"/images/besetztes_haus.jpg"},{id:"garnisonsfriedhof",caption:"Garnisonsfriedhof",audio:"/audio/garnisonsfriedhof.mp3",image:"/images/garnisionsfriedhof.jpg"},{id:"centraler-arbeitsnachweis",caption:"Centraler Arbeitsnachweis",audio:"/audio/arbeitsnachweis.mp3",image:"/images/arbeitsnachweiss.jpg"},{id:"wunschgarten",caption:"Wunschgarten",audio:"/audio/wunschgarten_flitterzaun.mp3",image:"/images/wunschgarten.jpg"},{id:"flitterzaun",caption:"Flitterzaun",audio:"/audio/wunschgarten_flitterzaun.mp3",image:"/images/flitterzaun.jpg"},{id:"volksbuehne",caption:"Volksbühne AM Rosa-Luxemburg-Platz",audio:"/audio/volksbuehne.mp3",image:"/images/volksbuehne.jpg"},{id:"arbeiterdenkmal",caption:"Arbeiterdenkmal",audio:"/audio/arbeiterdenkmal.mp3",image:"/images/arbeiterdenkmal.jpg"},{id:"karl-liebknecht-haus",caption:"Karl-Liebknecht-Haus",audio:"/audio/karl-liebknecht-haus.mp3",image:"/images/karl-liebknecht.jpg"},{id:"soho-House",caption:"Soho-House",audio:"/audio/soho-house.mp3",image:"/images/soho.jpg"},{id:"tips-please",caption:"Spenden",image:"/images/tip-jar.jpg"}]}),app.factory("Places",["StoryBoard","$log",function(e){var a=e();return{idToSlideIndex:function(e){var o=a.filter(function(a){return a.id==e});return o[0]?a.indexOf(o[0]):0},indexToSlideId:function(e){var o;return(o=a[e])?o.id:null},slides:a}}]);